# üìä Microservices Analytics Project

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑ –¥–≤—É—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:

- `event-service` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å —Å–æ–±—ã—Ç–∏–π (–æ–ø–∏—Å–∞–Ω–∏–µ API –≤ `openapi.yaml`);
- `stat-service` ‚Äî —Å–µ—Ä–≤–∏—Å —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ—Å–µ—â–µ–Ω–∏–π (`stat-service.json`).

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```text
[Client] --> [event-service] --> [stat-service]
event-service –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ —Å–≤–æ–∏–º –ø—É–±–ª–∏—á–Ω—ã–º endpoint'–∞–º –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–µ—â–µ–Ω–∏–∏ –≤ stat-service. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å–∏—Å—Ç–µ–º–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ —Å–æ–±–∏—Ä–∞–µ—Ç –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤.

üì¶ Stat Service
stat-service ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π API –¥–ª—è:

—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ endpoint'–∞–º;

–ø–æ–ª—É—á–µ–Ω–∏—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

üîå –î–æ—Å—Ç—É–ø–Ω—ã–µ endpoints
POST /hit
–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ endpoint'—É –¥—Ä—É–≥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:

json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
{
  "app": "event-service",
  "uri": "/events/1",
  "ip": "192.163.0.1",
  "timestamp": "2022-09-06 11:00:23"
}
–û—Ç–≤–µ—Ç: 201 Created ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞.

GET /stats
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ø–æ—Å–µ—â–µ–Ω–∏—è–º.

Query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

start (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): –Ω–∞—á–∞–ª–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (yyyy-MM-dd HH:mm:ss)

end (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): –∫–æ–Ω–µ—Ü –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (yyyy-MM-dd HH:mm:ss)

uris (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): —Å–ø–∏—Å–æ–∫ URI

unique (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): true ‚Äî —É—á–∏—Ç—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ IP

–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:

json
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
[
  {
    "app": "event-service",
    "uri": "/events/1",
    "hits": 6
  }
]
‚ö†Ô∏è –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ: –ø–∞—Ä–∞–º–µ—Ç—Ä—ã start –∏ end –Ω—É–∂–Ω–æ URL-–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é URLEncoder.encode –≤ Java).

üõ† –ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–æ–≤
–û—Ç–ø—Ä–∞–≤–∫–∞ hit'–∞
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
curl -X POST http://localhost:9090/hit \
  -H "Content-Type: application/json" \
  -d '{
    "app": "event-service",
    "uri": "/events/1",
    "ip": "192.163.0.1",
    "timestamp": "2022-09-06 11:00:23"
  }'
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
bash
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
curl -G http://localhost:9090/stats \
  --data-urlencode "start=2022-09-06 00:00:00" \
  --data-urlencode "end=2022-09-07 00:00:00" \
  --data-urlencode "uris=/events/1" \
  --data-urlencode "unique=true"
üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
perl
–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
.
‚îú‚îÄ‚îÄ event-service/           # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ stat-service/            # –°–µ—Ä–≤–∏—Å —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
‚îú‚îÄ‚îÄ openapi.yaml             # –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è event-service
‚îú‚îÄ‚îÄ stat-service.json        # –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è stat-service
‚îú‚îÄ‚îÄ README.md                # –≠—Ç–æ—Ç —Ñ–∞–π–ª
